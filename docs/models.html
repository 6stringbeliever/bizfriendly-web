<!DOCTYPE html>

<html>
<head>
  <title>models.py</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="__init__.html">
                __init__.py
              </a>
            
              
              <a class="source" href="admin.html">
                admin.py
              </a>
            
              
              <a class="source" href="api.html">
                api.py
              </a>
            
              
              <a class="source" href="config.html">
                config.py
              </a>
            
              
              <a class="source" href="forms.html">
                forms.py
              </a>
            
              
              <a class="source" href="models.html">
                models.py
              </a>
            
              
              <a class="source" href="routes.html">
                routes.py
              </a>
            
              
              <a class="source" href="BfUser.html">
                BfUser.js
              </a>
            
              
              <a class="source" href="config.html">
                config.js
              </a>
            
              
              <a class="source" href="connect.html">
                connect.js
              </a>
            
              
              <a class="source" href="edit.html">
                edit.js
              </a>
            
              
              <a class="source" href="instructions.html">
                instructions.js
              </a>
            
              
              <a class="source" href="learn.html">
                learn.js
              </a>
            
              
              <a class="source" href="lesson.html">
                lesson.js
              </a>
            
              
              <a class="source" href="new-category.html">
                new-category.js
              </a>
            
              
              <a class="source" href="new-service.html">
                new-service.js
              </a>
            
              
              <a class="source" href="profile.html">
                profile.js
              </a>
            
              
              <a class="source" href="service.html">
                service.js
              </a>
            
              
              <a class="source" href="teach.html">
                teach.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>models.py</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">from</span> flask.ext.sqlalchemy <span class="keyword">import</span> SQLAlchemy
<span class="keyword">import</span> hashlib, requests, os
<span class="keyword">from</span> bizfriendly <span class="keyword">import</span> app

db = SQLAlchemy(app)</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2 id="models">models</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">Category</span><span class="params">(db.Model)</span>:</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    id = db.Column(db.Integer, primary_key=<span class="keyword">True</span>)
    name = db.Column(db.Unicode, nullable=<span class="keyword">False</span>, unique=<span class="keyword">True</span>)
    description = db.Column(db.Unicode)
    state = db.Column(db.Unicode)
    created_dt = db.Column(db.DateTime(), default=db.func.now())</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Realtionships</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    creator_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'bf_user.id'</span>))
    creator = db.relationship(<span class="string">'Bf_user'</span>, backref=db.backref(<span class="string">'categories'</span>, lazy=<span class="string">'dynamic'</span>))

    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name=None, description=None, state=None, creator_id=None)</span>:</span>
        self.name = name
        self.description = description
        self.state = state
        self.creator_id = creator_id

    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span>
        <span class="keyword">return</span> self.name

<span class="class"><span class="keyword">class</span> <span class="title">Service</span><span class="params">(db.Model)</span>:</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    id = db.Column(db.Integer, primary_key=<span class="keyword">True</span>)
    name = db.Column(db.Unicode, nullable=<span class="keyword">False</span>, unique=<span class="keyword">True</span>)
    url = db.Column(db.Unicode)
    icon = db.Column(db.Unicode)
    short_description = db.Column(db.Unicode)
    long_description = db.Column(db.Unicode)
    additional_resources = db.Column(db.Unicode)
    tips = db.Column(db.Unicode)
    media = db.Column(db.Unicode)
    state = db.Column(db.Unicode)
    created_dt = db.Column(db.DateTime(), default=db.func.now())</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Relationships</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    category_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'category.id'</span>))
    category = db.relationship(<span class="string">'Category'</span>, backref=db.backref(<span class="string">'services'</span>, lazy=<span class="string">'dynamic'</span>))
    creator_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'bf_user.id'</span>))
    creator = db.relationship(<span class="string">'Bf_user'</span>, backref=db.backref(<span class="string">'services'</span>, lazy=<span class="string">'dynamic'</span>))

    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, category_id=None, name=None, url=None, icon=None, description=None, long_description=None, short_description=None, additional_resources=None, tips=None, media=None, state=None, creator_id=None )</span>:</span>
        self.name = name
        self.url = url
        self.icon = icon
        self.long_description = long_description
        self.short_description = short_description
        self.additional_resources = additional_resources
        self.tips = tips
        self.media = media
        self.state = state
        self.category_id = category_id
        self.creator_id = creator_id

    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span>
        <span class="keyword">return</span> self.name

<span class="class"><span class="keyword">class</span> <span class="title">Lesson</span><span class="params">(db.Model)</span>:</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    id = db.Column(db.Integer, primary_key=<span class="keyword">True</span>)
    name = db.Column(db.Unicode, nullable=<span class="keyword">False</span>, unique=<span class="keyword">True</span>)
    description = db.Column(db.Unicode)
    ease = db.Column(db.Unicode)
    state = db.Column(db.Unicode)
    created_dt = db.Column(db.DateTime(), default=db.func.now())</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Relationships</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    service_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'service.id'</span>), nullable=<span class="keyword">False</span>)
    service = db.relationship(<span class="string">'Service'</span>, backref=db.backref(<span class="string">'lessons'</span>, lazy=<span class="string">'dynamic'</span>))
    creator_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'bf_user.id'</span>))
    creator = db.relationship(<span class="string">'Bf_user'</span>, backref=db.backref(<span class="string">'lessons'</span>, lazy=<span class="string">'dynamic'</span>))

    <span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">(self, name=None, description=None, ease=None, state=None, service_id=None, creator_id=None)</span>:</span>
        self.name = name
        self.description = description
        self.ease = ease
        self.state = state
        self.service_id = service_id
        self.creator_id = creator_id

    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span>
        <span class="keyword">return</span> self.name

<span class="class"><span class="keyword">class</span> <span class="title">Step</span><span class="params">(db.Model)</span>:</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    id = db.Column(db.Integer, primary_key=<span class="keyword">True</span>)
    step_type = db.Column(db.Unicode)
    step_number = db.Column(db.Integer, nullable=<span class="keyword">False</span>)
    step_text = db.Column(db.Unicode)
    trigger_endpoint = db.Column(db.Unicode)
    place_in_collection = db.Column(db.Unicode)
    trigger_check = db.Column(db.Unicode)
    trigger_value = db.Column(db.Unicode)
    thing_to_remember = db.Column(db.Unicode)
    feedback = db.Column(db.Unicode)
    next_step_number = db.Column(db.Integer)
    created_dt = db.Column(db.DateTime(), default=db.func.now())</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Relationships</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    lesson_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'lesson.id'</span>), nullable=<span class="keyword">False</span>)
    lesson = db.relationship(<span class="string">'Lesson'</span>, backref=db.backref(<span class="string">'steps'</span>, lazy=<span class="string">'dynamic'</span>))
    creator_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'bf_user.id'</span>))

    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, step_number=None, step_type=None, step_text=None, trigger_endpoint=None, place_in_collection=None, trigger_check=None, trigger_value=None, thing_to_remember=None, feedback=None, next_step_number=None, lesson_id=None, creator_id=None)</span>:</span>
        self.step_number = step_number
        self.step_type = step_type
        self.step_text = step_text
        self.trigger_endpoint = trigger_endpoint
        self.place_in_collection = place_in_collection
        self.trigger_check = trigger_check
        self.trigger_value = trigger_value
        self.thing_to_remember = thing_to_remember
        self.feedback = feedback
        self.next_step_number = next_step_number
        self.lesson_id = lesson_id
        self.creator_id = creator_id

<span class="class"><span class="keyword">class</span> <span class="title">Bf_user</span><span class="params">(db.Model)</span>:</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    id = db.Column(db.Integer, primary_key=<span class="keyword">True</span>)
    email = db.Column(db.Unicode, nullable=<span class="keyword">False</span>, unique=<span class="keyword">True</span>)
    password = db.Column(db.Unicode, nullable=<span class="keyword">False</span>)
    access_token = db.Column(db.Unicode, nullable=<span class="keyword">False</span>)
    name = db.Column(db.Unicode, nullable=<span class="keyword">False</span>)
    business_name = db.Column(db.Unicode, nullable=<span class="keyword">True</span>)
    location = db.Column(db.Unicode, nullable=<span class="keyword">True</span>)
    reset_token = db.Column(db.BigInteger, nullable=<span class="keyword">True</span>)
    role = db.Column(db.Unicode, nullable=<span class="keyword">True</span>)
    created_dt = db.Column(db.DateTime(), default=db.func.now())</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Relations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    lessons_completed = db.relationship(<span class="string">"UserLesson"</span>)
    lessons_created = db.relationship(<span class="string">"Lesson"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>TODO: Decide how strict this email validation should be
@validates(&#39;email&#39;)
def validate_email(self, key, address):
    pass</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, email=None, password=None, name=None, business_name=None, location=None, role=None)</span>:</span>
        self.email = str(email)
        password = str(password)
        self.access_token = hashlib.sha256(str(os.urandom(<span class="number">24</span>))).hexdigest()
        self.password = self.pw_digest(password)
        self.name = name
        self.business_name = business_name
        self.location = location
        self.role = <span class="string">"user"</span>

    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span>
        <span class="keyword">return</span> <span class="string">"Bf_user email: %s, id: %s"</span> %(self.email, self.id)

    <span class="function"><span class="keyword">def</span> <span class="title">pw_digest</span><span class="params">(self, password)</span>:</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Hash password, store it with random signature for rehash</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        salt = hashlib.sha256(str(os.urandom(<span class="number">24</span>))).hexdigest()
        hsh = hashlib.sha256(salt + password).hexdigest()
        <span class="keyword">return</span> <span class="string">'%s$%s'</span> % (salt, hsh)

    <span class="function"><span class="keyword">def</span> <span class="title">check_pw</span><span class="params">(self, raw_password)</span>:</span>
        salt, hsh = self.password.split(<span class="string">'$'</span>)
        <span class="keyword">return</span> hashlib.sha256(salt + raw_password).hexdigest() == hsh

    <span class="function"><span class="keyword">def</span> <span class="title">make_authorized_request</span><span class="params">(self, service, req_url)</span>:</span>
        <span class="keyword">for</span> connection <span class="keyword">in</span> self.connections:
            <span class="keyword">if</span> connection.service == service:
                <span class="keyword">return</span> requests.get(req_url + connection.access_token, headers={<span class="string">'User-Agent'</span>: <span class="string">'Python'</span>})

    <span class="function"><span class="keyword">def</span> <span class="title">is_authenticated</span><span class="params">(self)</span>:</span>
        <span class="keyword">return</span> <span class="keyword">True</span>

    <span class="function"><span class="keyword">def</span> <span class="title">is_active</span><span class="params">(self)</span>:</span>
        <span class="keyword">return</span> <span class="keyword">True</span>

    <span class="function"><span class="keyword">def</span> <span class="title">is_anonymous</span><span class="params">(self)</span>:</span>
        <span class="keyword">return</span> <span class="keyword">False</span>

    <span class="function"><span class="keyword">def</span> <span class="title">get_id</span><span class="params">(self)</span>:</span>
        <span class="keyword">return</span> unicode(self.id)

<span class="class"><span class="keyword">class</span> <span class="title">UserLesson</span><span class="params">(db.Model)</span>:</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    __tablename__ = <span class="string">'user_to_lesson'</span>
    recent_step_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'step.id'</span>))
    recent_step_number = db.Column(db.Integer)
    start_dt = db.Column(db.DateTime(timezone=<span class="keyword">False</span>))
    end_dt = db.Column(db.DateTime(timezone=<span class="keyword">False</span>), nullable=<span class="keyword">True</span>)
    completed = db.Column(db.Boolean)</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Relationships</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    user_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'bf_user.id'</span>), primary_key=<span class="keyword">True</span>)
    lesson_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'lesson.id'</span>), primary_key=<span class="keyword">True</span>)
    lesson = db.relationship(<span class="string">'Lesson'</span>)
    user = db.relationship(<span class="string">'Bf_user'</span>)

    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, start_dt=None, end_dt=None, recent_step_id=None, recent_step_number=None)</span>:</span>
        self.recent_step_id = recent_step_id
        self.recent_step_number = recent_step_number
        self.start_dt = start_dt 
        self.end_dt = end_dt
        self.completed = <span class="keyword">False</span>

    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span>
        <span class="keyword">return</span> <span class="string">"User_to_lesson user_id: %s, lesson_id: %s"</span> % (self.user_id, self.lesson_id)

<span class="class"><span class="keyword">class</span> <span class="title">Connection</span><span class="params">(db.Model)</span>:</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    id = db.Column(db.Integer, primary_key=<span class="keyword">True</span>)
    service = db.Column(db.Unicode)
    access_token = db.Column(db.Unicode)
    created_dt = db.Column(db.DateTime(), default=db.func.now())</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Relationships</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    user_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'bf_user.id'</span>))
    user = db.relationship(<span class="string">'Bf_user'</span>, backref=db.backref(<span class="string">'connections'</span>, lazy=<span class="string">'dynamic'</span>))

    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, service=None, access_token=None)</span>:</span>
        self.service = service
        self.access_token = access_token

    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span>
        <span class="keyword">return</span> <span class="string">"Connection user_id: %s, service: %s"</span> % (self.user_id, self.service)</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
