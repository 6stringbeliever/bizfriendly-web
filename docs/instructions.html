<!DOCTYPE html>

<html>
<head>
  <title>instructions.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="__init__.html">
                __init__.py
              </a>
            
              
              <a class="source" href="admin.html">
                admin.py
              </a>
            
              
              <a class="source" href="api.html">
                api.py
              </a>
            
              
              <a class="source" href="config.html">
                config.py
              </a>
            
              
              <a class="source" href="forms.html">
                forms.py
              </a>
            
              
              <a class="source" href="models.html">
                models.py
              </a>
            
              
              <a class="source" href="routes.html">
                routes.py
              </a>
            
              
              <a class="source" href="BfUser.html">
                BfUser.js
              </a>
            
              
              <a class="source" href="config.html">
                config.js
              </a>
            
              
              <a class="source" href="connect.html">
                connect.js
              </a>
            
              
              <a class="source" href="edit.html">
                edit.js
              </a>
            
              
              <a class="source" href="instructions.html">
                instructions.js
              </a>
            
              
              <a class="source" href="learn.html">
                learn.js
              </a>
            
              
              <a class="source" href="lesson.html">
                lesson.js
              </a>
            
              
              <a class="source" href="new-category.html">
                new-category.js
              </a>
            
              
              <a class="source" href="new-service.html">
                new-service.js
              </a>
            
              
              <a class="source" href="profile.html">
                profile.js
              </a>
            
              
              <a class="source" href="service.html">
                service.js
              </a>
            
              
              <a class="source" href="teach.html">
                teach.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>instructions.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> instructions = (<span class="function"><span class="keyword">function</span> <span class="params">(instructions)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>private properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> width = window.screen.width;
  <span class="keyword">var</span> height = window.screen.height;
  <span class="keyword">var</span> lesson = {};
  <span class="keyword">var</span> service = {}
  <span class="keyword">var</span> steps = []
  <span class="keyword">var</span> previewLesson;
  <span class="keyword">if</span> (window.opener){ <span class="comment">// Emailed links don't have an opener.</span>
    <span class="keyword">if</span> (window.opener.document.preview) {
      console.log(<span class="string">"Preview"</span>)
      previewLesson = <span class="literal">true</span>;
      lesson.name = window.opener.document.preview.lessonName.value;
      lesson.creator = {}
      lesson.service = {}
      lesson.creator.name = window.opener.document.preview.authorName.value;
      lesson.service.name = window.opener.document.preview.serviceName.value;
      lesson.service.id = window.opener.document.preview.serviceId.value;
      lesson.steps = window.opener.document.preview.steps.value;
      console.log(lesson.steps);
      lesson.steps = $.parseJSON(lesson.steps);</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>console.log(steps);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    }
  }
  <span class="keyword">var</span> bodyPadding = <span class="number">0</span>;
  <span class="keyword">var</span> lessonId = <span class="number">0</span>; <span class="comment">// Blank lesson</span>
  <span class="keyword">var</span> step = {};
  <span class="keyword">var</span> oauthToken = <span class="literal">null</span>;
  <span class="keyword">var</span> currentStep = {};
  <span class="keyword">var</span> rememberedAttribute;
  <span class="keyword">var</span> postData = {};
  <span class="keyword">var</span> originalCount = <span class="literal">false</span>;
  <span class="keyword">var</span> originalAttributeValues = <span class="literal">false</span>;
  <span class="keyword">var</span> challengeWindow;
  <span class="keyword">var</span> user_id;
  <span class="keyword">var</span> feedback;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>variables for meta lesson</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> userName;
  <span class="keyword">var</span> city;
  <span class="keyword">var</span> state;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>PUBLIC METHODS
initialize variables and load JSON</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">()</span>{</span>
    <span class="keyword">if</span> (config.debug) console.log(<span class="string">'init'</span>);
    <span class="keyword">if</span> (previewLesson) {
      _main()
    } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Get lessonId from the url</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      lessonId = window.location.search.split(<span class="string">'?'</span>)[<span class="number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Call the API and get that lesson</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $.getJSON(config.bfUrl+config.bfApiVersion+<span class="string">'/lessons/'</span>+lessonId, _main);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>PRIVATE METHODS </p>
<p>Main Function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_main</span><span class="params">(response)</span>{</span>
    _checkWindowSize();
    <span class="keyword">if</span> (!previewLesson){</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Attach response to global lesson variable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      lesson = response;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Set the name of the lesson</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="string">'#instructions-title'</span>).html(lesson.name);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Set author name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (config.debug) console.log(lesson);
    $(<span class="string">'#author-name'</span>).text(lesson.creator.name);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Make sure steps are in order of id</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _orderSteps();</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Convert python names to javascript names</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _convertStepsAttributesNames();</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Set current step</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    currentStep = steps[<span class="number">0</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Initialize steps state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _updateStepsStates();</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Build progress bar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _makeProgressBar();</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Update progress Bar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _updateProgressBar();</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Show first step</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _showStep();
    _checkStep();</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Adds button event handlers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="string">'#back'</span>).click(_backClicked);
    $(<span class="string">'#next'</span>).click(_nextClicked);
    $(<span class="string">"#close-lesson"</span>).click(<span class="function"><span class="keyword">function</span><span class="params">(evt)</span>{</span>window.close();});
    $(<span class="string">'li.progress-button'</span>).click(_progressClicked);
  }

  <span class="function"><span class="keyword">function</span> <span class="title">_checkWindowSize</span><span class="params">()</span>{</span>
    <span class="keyword">if</span> (config.debug) console.log(window.innerWidth);
    <span class="keyword">if</span>(window.innerWidth &gt; <span class="number">340</span>){
      window.resizeTo(<span class="number">340</span>,height);
      window.moveTo(width-<span class="number">340</span>,<span class="number">0</span>);
    }
  }

  <span class="function"><span class="keyword">function</span> <span class="title">_orderSteps</span><span class="params">()</span>{</span>
    <span class="keyword">if</span> (config.debug) console.log(<span class="string">'ordering steps'</span>);
    steps = lesson.steps.sort(<span class="function"><span class="keyword">function</span><span class="params">(a, b)</span>{</span>
      <span class="keyword">if</span> (a.step_number &lt; b.step_number) <span class="keyword">return</span> -<span class="number">1</span>;
      <span class="keyword">if</span> (a.step_number &gt; b.step_number) <span class="keyword">return</span> <span class="number">1</span>;
      <span class="keyword">return</span> <span class="number">0</span>;
    })
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Change steps attributes to have camelCase</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_convertStepsAttributesNames</span><span class="params">()</span>{</span>
    <span class="keyword">if</span> (config.debug) console.log(<span class="string">'Change attribute names to camelCase.'</span>);
    <span class="keyword">var</span> stepsWithJsNames = [];
    $(steps).each(<span class="function"><span class="keyword">function</span><span class="params">(i)</span>{</span>
      step = {
        id : steps[i].id,
        stepType : steps[i].step_type,
        stepNumber : steps[i].step_number,
        stepText : steps[i].step_text,
        triggerEndpoint : steps[i].trigger_endpoint,
        placeInCollection : steps[i].place_in_collection,
        triggerCheck : steps[i].trigger_check,
        triggerValue : steps[i].trigger_value,
        thingToRemember : steps[i].thing_to_remember,
        feedback : steps[i].feedback,
        nextStepNumber : steps[i].next_step_number,
        stepState : <span class="string">"unfinished"</span>
      }
      stepsWithJsNames.push(step);
    })
    steps = stepsWithJsNames;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Set the steps state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_updateStepsStates</span><span class="params">()</span>{</span>
    <span class="keyword">if</span> (config.debug) console.log(<span class="string">'updating steps states'</span>);
    $(steps).each(<span class="function"><span class="keyword">function</span><span class="params">(i)</span>{</span>
      <span class="keyword">if</span> (currentStep.stepNumber == steps[i].stepNumber){
        steps[i].stepState = <span class="string">"active"</span>;
      }
      <span class="keyword">if</span> (currentStep.stepNumber &gt; steps[i].stepNumber){
        steps[i].stepState = <span class="string">"finished"</span>;
      }
      <span class="keyword">if</span> (currentStep.stepNumber &lt; steps[i].stepNumber){
        steps[i].stepState = <span class="string">"unfinished"</span>;
      }
    })
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Make progress bar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_makeProgressBar</span><span class="params">()</span>{</span>
    <span class="keyword">if</span> (config.debug) console.log(<span class="string">'making progress bar'</span>);
    $(steps).each(<span class="function"><span class="keyword">function</span><span class="params">(i)</span>{</span>
        $(<span class="string">'.progress-dots'</span>).append(<span class="string">'&lt;li id="step'</span>+steps[i].stepNumber+<span class="string">'_progress" class="progress-button" data-target="'</span>+steps[i].stepNumber+<span class="string">'"&gt;&lt;/li&gt;'</span>);
    });
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Update the progress bar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_updateProgressBar</span><span class="params">()</span>{</span>
    <span class="keyword">if</span> (config.debug) console.log(<span class="string">'updating progress bar'</span>);
    $(steps).each(<span class="function"><span class="keyword">function</span><span class="params">(i)</span>{</span>
      $(<span class="string">'#step'</span>+steps[i].stepNumber+<span class="string">'_progress'</span>).removeClass(<span class="string">'unfinished active finished'</span>).addClass(steps[i].stepState);
      <span class="keyword">if</span> (steps[i].stepNumber == currentStep.stepNumber){
        $(<span class="string">'#step'</span>+steps[i].stepNumber+<span class="string">'_progress'</span>).html(<span class="string">'&lt;h2&gt;'</span>+currentStep.stepNumber+<span class="string">'&lt;/h2&gt;'</span>);
      } <span class="keyword">else</span> {
        $(<span class="string">'#step'</span>+steps[i].stepNumber+<span class="string">'_progress'</span>).html(<span class="string">''</span>);
      }
    })
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Show the current step</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_showStep</span><span class="params">()</span>{</span>
    _stepTransition();
    <span class="keyword">if</span> (config.debug) console.log(<span class="string">'showing step'</span>);
    $(<span class="string">'section'</span>).attr(<span class="string">'id'</span>,<span class="string">'step'</span>+currentStep.stepNumber);
    $(<span class="string">'#step-text-content'</span>).html(currentStep.stepText);
    $(<span class="string">'#feedback-content'</span>).html(currentStep.feedback);</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Save progress of every step taken</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (!previewLesson){
      console.log(<span class="string">"Recording step completion."</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Record most recent opened step</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      postData = {
          currentStepId : currentStep.id,
          currentLessonId : lesson.id,
          auth : BfUser.bfAccessToken
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>console.log(postData);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      BfUser.record_step(postData, _recordedStep);
    }
  }

  <span class="function"><span class="keyword">function</span> <span class="title">_stepTransition</span><span class="params">()</span>{</span>
    <span class="keyword">if</span> (config.debug) console.log(<span class="string">'Step Transition'</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>next button is clicked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_nextClicked</span><span class="params">(evt)</span>{</span>
    <span class="keyword">if</span> (currentStep.stepNumber &lt; steps.length){
      _goToNextStep();
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>back button is clicked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_backClicked</span><span class="params">(evt)</span>{</span>
    <span class="keyword">if</span> (currentStep.stepNumber &gt; <span class="number">1</span>){
      currentStep = steps[currentStep.stepNumber - <span class="number">2</span>];
      _updateStepsStates();
      _updateProgressBar();
      _showStep();
      _checkStep();
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>progress circle li element is clicked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_progressClicked</span><span class="params">(evt)</span> {</span>
    console.log(<span class="string">"Clicked Step: "</span> + $(<span class="keyword">this</span>).attr(<span class="string">'data-target'</span>));
    currentStep = steps[$(<span class="keyword">this</span>).attr(<span class="string">'data-target'</span>) - <span class="number">1</span>];
    _updateStepsStates();
    _updateProgressBar();
    _showStep();
    _checkStep();
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>login clicked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_loginClicked</span><span class="params">(evt)</span>{</span>
    service = lesson.service.name.toLowerCase();
    <span class="keyword">if</span> (config.debug) console.log(<span class="string">'Logging into '</span>+service);
    OAuth.initialize(<span class="string">'uZPlfdN3A_QxVTWR2s9-A8NEyZs'</span>);
    <span class="keyword">var</span> options;
    <span class="keyword">if</span> (service == <span class="string">'facebook'</span>){
      options = {authorize:{display:<span class="string">"popup"</span>}};
    }
    <span class="keyword">if</span> (service == <span class="string">'foursquare'</span>){
      options = {authorize:{display:<span class="string">"touch"</span>}};
    }
    <span class="keyword">if</span> (service == <span class="string">'trello'</span>){
      options = {authorize:{name:<span class="string">"BizFriendly"</span>,expiration:<span class="string">"never"</span>}};
    }
    OAuth.popup(service, options, <span class="function"><span class="keyword">function</span><span class="params">(error, result)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>handle error with error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (error) console.log(error);
      <span class="keyword">if</span> (config.debug) console.log(result);

      <span class="keyword">if</span> (result.hasOwnProperty(<span class="string">"access_token"</span>)){
        oauthToken = result.access_token;
      }
      <span class="keyword">if</span> (result.hasOwnProperty(<span class="string">"oauth_token"</span>)){
        oauthToken = result.oauth_token;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Add connection to server db</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">var</span> data = {service: service, service_access: oauthToken}
      BfUser.create_connection(data, _createdConnection);</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Check first step</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _checkStep();  
    }); 
  }

  <span class="function"><span class="keyword">function</span> <span class="title">_goToNextStep</span><span class="params">()</span>{</span>
    $(<span class="string">"#feedback"</span>).modal(<span class="string">"hide"</span>);
    currentStep = steps[currentStep.stepNumber];
    _updateStepsStates();
    _updateProgressBar();
    _showStep();
    _checkStep();
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Check steps</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_checkStep</span><span class="params">()</span>{</span>

    <span class="keyword">if</span> (config.debug) console.log(currentStep);</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Create postData</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    postData = {
      currentStep : currentStep,
      rememberedAttribute : rememberedAttribute,
      lessonName : lesson.name,
      lessonId : lesson.id,
      thirdPartyService : service,
      originalCount : <span class="literal">false</span>,
      originalAttributeValues : <span class="literal">false</span>
    }

    <span class="keyword">if</span> (currentStep.stepType == <span class="string">'meta_intro'</span>){</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Get the users name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(<span class="string">"#userInputSubmit"</span>).click(<span class="function"><span class="keyword">function</span><span class="params">(evt)</span>{</span>
        userName = $(<span class="string">'#userInput'</span>).val();
        $(<span class="string">'.responseDisplay'</span>).text(userName);
        $(<span class="string">'.feedback'</span>).toggle();
        $(<span class="string">'.step_text'</span>).toggle();
      });
    }

    <span class="keyword">if</span> (currentStep.stepType == <span class="string">'meta_location'</span>){</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Get the users name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $.getJSON(<span class="string">'http://ip-api.com/json'</span>, <span class="function"><span class="keyword">function</span><span class="params">(response)</span>{</span>
        city = response.city;
        state = response.regionName;
        $(<span class="string">'.cityName'</span>).text(city);
        $(<span class="string">'.stateName'</span>).text(state);
        rememberedAttribute = <span class="string">'find_loc='</span>+city+<span class="string">',+'</span>+state
        rememberedAttribute = rememberedAttribute.replace(<span class="string">' '</span>,<span class="string">'+'</span>);
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Check with them if location was correct</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(<span class="string">'#yes'</span>).click(<span class="function"><span class="keyword">function</span><span class="params">(evt)</span>{</span>
        _goToNextStep();
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>If no, then take in the new address</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(<span class="string">'#no'</span>).click(<span class="function"><span class="keyword">function</span><span class="params">(evt)</span>{</span>
        $(<span class="string">'.feedback'</span>).toggle();
        $(<span class="string">'#feedbackYes'</span>).hide();
        $(<span class="string">'.step_text'</span>).toggle();</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Get new city, state and go to the next step.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="string">'#userInputSubmit'</span>).click(<span class="function"><span class="keyword">function</span><span class="params">(evt)</span>{</span>
          city = $(<span class="string">'#userInputCity'</span>).val();
          state = $(<span class="string">'#userInputState'</span>).val();
          rememberedAttribute = <span class="string">'find_loc='</span>+city+<span class="string">',+'</span>+state
          rememberedAttribute = rememberedAttribute.replace(<span class="string">' '</span>,<span class="string">'+'</span>);
          _goToNextStep();
        });
      });
    }

    <span class="keyword">if</span> (currentStep.stepType == <span class="string">'meta_search'</span>){</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Did they find their biz?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(<span class="string">'.yes'</span>).click(<span class="function"><span class="keyword">function</span><span class="params">(evt)</span>{</span>
        $(<span class="string">'.feedback'</span>).show();
        $(<span class="string">'.feedbackYes'</span>).show();
        $(<span class="string">'.feedbackYes3'</span>).hide();
        $(<span class="string">'.feedbackNo'</span>).hide();
        $(<span class="string">'.feedbackNo2'</span>).hide();
        $(<span class="string">'.feedbackNo3'</span>).hide()
        $(<span class="string">'.step_text'</span>).hide();
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>If no, then search again</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(<span class="string">'.no'</span>).click(<span class="function"><span class="keyword">function</span><span class="params">(evt)</span>{</span>
        $(<span class="string">'.feedback'</span>).show();
        $(<span class="string">'.feedbackYes'</span>).hide();
        $(<span class="string">'.feedbackYes3'</span>).hide();
        $(<span class="string">'.feedbackNo'</span>).show();
        $(<span class="string">'.feedbackNo2'</span>).hide();
        $(<span class="string">'.feedbackNo3'</span>).hide()
        $(<span class="string">'.step_text'</span>).hide();
      });
      $(<span class="string">'.no2'</span>).click(<span class="function"><span class="keyword">function</span><span class="params">(evt)</span>{</span>
        $(<span class="string">'.feedback'</span>).show();
        $(<span class="string">'.feedbackYes'</span>).hide();
        $(<span class="string">'.feedbackYes3'</span>).hide();
        $(<span class="string">'.feedbackNo'</span>).hide();
        $(<span class="string">'.feedbackNo2'</span>).show();
        $(<span class="string">'.feedbackNo3'</span>).hide()
        $(<span class="string">'.step_text'</span>).hide();
      });
      $(<span class="string">'.yes3'</span>).click(<span class="function"><span class="keyword">function</span><span class="params">(evt)</span>{</span>
        $(<span class="string">'.feedback'</span>).show();
        $(<span class="string">'.feedbackYes'</span>).hide();
        $(<span class="string">'.feedbackYes3'</span>).show();
        $(<span class="string">'.feedbackNo'</span>).hide();
        $(<span class="string">'.feedbackNo2'</span>).hide();
        $(<span class="string">'.feedbackNo3'</span>).hide()
        $(<span class="string">'.step_text'</span>).hide();
      });
      $(<span class="string">'.no3'</span>).click(<span class="function"><span class="keyword">function</span><span class="params">(evt)</span>{</span>
        $(<span class="string">'.feedback'</span>).show();
        $(<span class="string">'.feedbackYes'</span>).hide();
        $(<span class="string">'.feedbackYes3'</span>).hide();
        $(<span class="string">'.feedbackNo'</span>).hide();
        $(<span class="string">'.feedbackNo2'</span>).hide();
        $(<span class="string">'.feedbackNo3'</span>).show()
        $(<span class="string">'.step_text'</span>).hide();
      });
    }

    <span class="keyword">if</span> (currentStep.stepType == <span class="string">'meta_signup'</span>){
      console.log(<span class="string">'meta_signup'</span>);
      $(<span class="string">'#signup-name'</span>).val(userName);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>If step type is login</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (currentStep.stepType == <span class="string">'login'</span>){</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>First step should have a login button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (!oauthToken){
          $(<span class="string">'#login'</span>).click(_loginClicked);
        }
        <span class="keyword">else</span> {
          _loggedIn();
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>If step type is open</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (currentStep.stepType == <span class="string">'open'</span>){
      $(<span class="string">"#open"</span>).click(_openClicked);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>If step type is check_for_new</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (currentStep.stepType == <span class="string">'check_for_new'</span> &amp;&amp; oauthToken){
      <span class="keyword">if</span> (config.debug) console.log(<span class="string">"ORIGINAL COUNT: "</span>+originalCount);</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>This step fires at least twice. First time it just gets the originalCount
Every following time it compares the number of objects to the originalCount</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> ( originalCount !== <span class="literal">false</span> ){
        <span class="keyword">if</span> (config.debug) console.log(<span class="string">"originalCount: "</span> + originalCount);
        postData[<span class="string">"originalCount"</span>] = originalCount;
      }
      BfUser.check_for_new(postData, _checkForNew);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>check_if_attribute_exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (currentStep.stepType == <span class="string">'check_if_attribute_exists'</span> &amp;&amp; oauthToken){
      <span class="keyword">if</span> (config.debug) console.log(currentStep);
      BfUser.check_if_attribute_exists(postData, _checkIfAttributeExists);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>check_attribute_for_value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (currentStep.stepType == <span class="string">'check_attribute_for_value'</span> &amp;&amp; oauthToken){
      BfUser.check_attribute_for_value(postData, _checkAttributeForValue);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Is step type get_attributes_from_input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (currentStep.stepType == <span class="string">'get_attributes_from_input'</span>){</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>First get the id from the input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(<span class="string">'#userInputSubmit'</span>).click(<span class="function"><span class="keyword">function</span><span class="params">(evt)</span>{</span>
        <span class="keyword">var</span> userInput = $(<span class="string">'#userInput'</span>).val();</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>If Foursquare, get venue id from input URL.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (service == <span class="string">'foursquare'</span>){
          <span class="keyword">var</span> userInputPath = userInput.split( <span class="string">'/'</span> );
          rememberedAttribute = userInputPath.pop();
        }
        challengeWindow.close();
        _openChallengeWindow(userInput);

        postData[<span class="string">"rememberedAttribute"</span>] = rememberedAttribute;</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Then call get_attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        BfUser.get_attributes(postData, _getAttributes);
      });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>check_attribute_for_update</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (currentStep.stepType == <span class="string">'check_attribute_for_update'</span> &amp;&amp; oauthToken){
      console.log(originalAttributeValues);</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>This step fires at least twice. First time it just gets the originalAttributeValues
Every following time it compares the value of the attribute to the originalAttributeValues</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> ( originalAttributeValues ){
        <span class="keyword">if</span> (config.debug) console.log(<span class="string">"originalAttributeValues: "</span> + originalAttributeValues);
        postData[<span class="string">"originalAttributeValues"</span>] = originalAttributeValues.toString();
      }
      console.log(postData);
      BfUser.check_attribute_for_update(postData, _checkAttributeForUpdate);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>congrats</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (currentStep.stepType == <span class="string">'congrats'</span>){
      $(<span class="string">'#fb-share'</span>).attr(<span class="string">'href'</span>, <span class="string">'http://api.addthis.com/oexchange/0.8/forward/facebook/offer?pubId=ra-52043c6b31185dab&amp;url=http://bizfriend.ly/lesson.html?'</span>+lessonId);
      $(<span class="string">'#tw-share'</span>).attr(<span class="string">'href'</span>, <span class="string">'http://api.addthis.com/oexchange/0.8/forward/twitter/offer?pubId=ra-52043c6b31185dab&amp;url=http://bizfriend.ly/lesson.html?'</span>+lessonId+<span class="string">'&amp;text=I just finished '</span>+lesson.name+<span class="string">' with help from BizFriendly!'</span>);
      $(<span class="string">'#g-share'</span>).attr(<span class="string">'href'</span>, <span class="string">'http://api.addthis.com/oexchange/0.8/forward/google_plusone_share/offer?pubId=ra-52043c6b31185dab&amp;url=http://bizfriend.ly/lesson.html?'</span>+lessonId);
      $(<span class="string">'#li-share'</span>).attr(<span class="string">'href'</span>, <span class="string">'http://api.addthis.com/oexchange/0.8/forward/linkedin/offer?pubId=ra-52043c6b31185dab&amp;url=http://bizfriend.ly/lesson.html?'</span>+lessonId);
      $(<span class="string">"#next"</span>).hide();
      $(<span class="string">"#back"</span>).hide();
      $(<span class="string">"#close-lesson"</span>).show();
      $(<span class="string">"#additional-resources"</span>).click(<span class="function"><span class="keyword">function</span><span class="params">(evt)</span>{</span>
        window.opener.location.href = <span class="string">"service.html?"</span>+serviceId;
        window.close();
      });
      $(<span class="string">"#more-lessons"</span>).click(<span class="function"><span class="keyword">function</span><span class="params">(evt)</span>{</span>
        window.opener.location.href = <span class="string">"learn.html"</span>;
        window.close();
      });
    } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Show controls</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(<span class="string">"#next"</span>).show();
      $(<span class="string">"#back"</span>).show();
      $(<span class="string">"#close-lesson"</span>).hide();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Add example popover clicker</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> example = $(<span class="string">'#example'</span>).html();
    $(<span class="string">'#example'</span>).css(<span class="string">'display'</span>,<span class="string">'none'</span>);
    $(<span class="string">'#popover'</span>).popover({ content: example, html: <span class="literal">true</span>, placement: <span class="string">'top'</span>, trigger: <span class="string">'hover'</span> });
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>They are loggedIn</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_loggedIn</span><span class="params">()</span>{</span>
      $(<span class="string">"#feedback"</span>).modal(<span class="string">"show"</span>);
      $(<span class="string">"#feedback-next"</span>).click(_goToNextStep);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Saved a connection in the db</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_createdConnection</span><span class="params">(response)</span>{</span>
    <span class="keyword">if</span> (config.debug) console.log(response);
  }

  <span class="function"><span class="keyword">function</span> <span class="title">_recordedStep</span><span class="params">(response)</span>{</span>
    <span class="keyword">if</span> (config.debug) console.log(response);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Open up the main window to the web service we want to teach.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_openChallengeWindow</span><span class="params">(url)</span>{</span>
    <span class="keyword">var</span> width = window.screen.width;
    <span class="keyword">var</span> height = window.screen.height;
    <span class="keyword">var</span> challengeFeatures = {
      height: height,
      width: width - <span class="number">340</span>,
      name: <span class="string">'challenge'</span>,
      center: <span class="literal">false</span>
    }
    challengeWindow = $.popupWindow(url, challengeFeatures);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>.open is clicked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_openClicked</span><span class="params">(evt)</span>{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>If url has replace_me in it, replace with rememberedAttribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (config.debug) console.log(currentStep.triggerEndpoint);
    <span class="keyword">if</span> (config.debug) console.log(rememberedAttribute);
    <span class="keyword">if</span>(currentStep.triggerEndpoint.indexOf(<span class="string">'replace_me'</span>) != -<span class="number">1</span>){
      currentStep.triggerEndpoint = currentStep.triggerEndpoint.replace(<span class="string">'replace_me'</span>,rememberedAttribute);
    }
    _openChallengeWindow(currentStep.triggerEndpoint);</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Advance to next step</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="string">"#feedback"</span>).modal(<span class="string">"show"</span>);
    $(<span class="string">"#feedback-next"</span>).click(_goToNextStep);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>A new object is added at a url endpoint
Remember a certain attribute, object id for example.
Display another attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_checkForNew</span><span class="params">(response)</span>{</span>
    <span class="keyword">if</span> (config.debug) console.log(response);
    response = $.parseJSON(response);
    <span class="keyword">if</span> (response.timeout) _checkStep();
    <span class="keyword">if</span> ( !response.new_object_added ){
      <span class="keyword">if</span> ( response.original_count !== <span class="literal">false</span> ){</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>If no new thing added, yet there is an original count
then ask again with the count in the post data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        originalCount = response.original_count;
        _checkStep();
      }
    }
    <span class="keyword">if</span> ( response.new_object_added ){</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Remember the attribute!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      rememberedAttribute = response.attribute_to_remember;
      <span class="keyword">if</span> (response.attribute_to_display.indexOf(<span class="string">"http"</span>) != -<span class="number">1</span>){
        $(<span class="string">'#step'</span>+currentStep.stepNumber+<span class="string">' .responseDisplay'</span>).attr(<span class="string">'src'</span>,response.attribute_to_display);
      } <span class="keyword">else</span> {
        $(<span class="string">'#step'</span>+currentStep.stepNumber+<span class="string">' .responseDisplay'</span>).text(response.attribute_to_display);
      }
      $(<span class="string">"#feedback"</span>).modal(<span class="string">"show"</span>);
      $(<span class="string">"#feedback-next"</span>).click(_goToNextStep);</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Cancel out originalCount!!!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      originalCount = <span class="literal">false</span>;
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>A certain attribute exists at the url endpoint
Display the returned attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_checkIfAttributeExists</span><span class="params">(response)</span>{</span>
    <span class="keyword">if</span> (config.debug) console.log(response);
    response = $.parseJSON(response);
    <span class="keyword">if</span> (response.timeout) _checkStep();
    <span class="keyword">if</span> ( response.attribute_exists ){
      $(<span class="string">'#step'</span>+currentStep.stepNumber+<span class="string">' .responseDisplay'</span>).html(response.attribute_to_display);
      $(<span class="string">"#feedback"</span>).modal(<span class="string">"show"</span>);
      $(<span class="string">"#feedback-next"</span>).click(_goToNextStep);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>A certain attribute equals a determined value
Display the returned attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_checkAttributeForValue</span><span class="params">(response)</span>{</span>
    <span class="keyword">if</span> (config.debug) console.log(response);
    response = $.parseJSON(response);
    <span class="keyword">if</span> (response.timeout) _checkStep();
    <span class="keyword">if</span> (response.attribute_value_matches) {</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>If the repsonse is an url of an image, attach it to the source.
ToDo: Make sure this is an actual image, in the future we might want urls</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> (response.attribute_to_display.indexOf(<span class="string">"http"</span>) != -<span class="number">1</span>){
        $(<span class="string">'#step'</span>+currentStep.stepNumber+<span class="string">' .responseDisplay'</span>).attr(<span class="string">'src'</span>,response.attribute_to_display);
      } <span class="keyword">else</span> {
        $(<span class="string">'#step'</span>+currentStep.stepNumber+<span class="string">' .responseDisplay'</span>).text(response.attribute_to_display);
      }
      $(<span class="string">"#feedback"</span>).modal(<span class="string">"show"</span>);
      $(<span class="string">"#feedback-next"</span>).click(_goToNextStep);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>An attribute of the object is updated
Display that attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_checkAttributeForUpdate</span><span class="params">(response)</span>{</span>
    <span class="keyword">if</span> (config.debug) console.log(response);
    response = $.parseJSON(response);
    <span class="keyword">if</span> (response.timeout) _checkStep();
    <span class="keyword">if</span> ( !response.attribute_value_updated ){
      <span class="keyword">if</span> ( response.original_attribute_values != <span class="literal">false</span> ){</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>If the attribute hasn&#39;t been updated, yet we have the original value
then ask again with the original value in the request.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        originalAttributeValues = response.original_attribute_values;
        console.log(<span class="string">'Checking again with original_value'</span>);
        _checkStep();
      }
    }
    <span class="keyword">if</span> ( response.attribute_value_updated ){</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Remember the attribute!
rememberedAttribute = response.attribute_to_remember;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(<span class="string">'#step'</span>+currentStep.stepNumber+<span class="string">' .responseDisplay'</span>).html(response.attribute_to_display);
      $(<span class="string">"#feedback"</span>).modal(<span class="string">"show"</span>);
      $(<span class="string">"#feedback-next"</span>).click(_goToNextStep);</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Cancel out original attributes!!!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      originalAttributeValues = <span class="literal">false</span>;
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Display the returned attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="keyword">function</span> <span class="title">_getAttributes</span><span class="params">(response)</span>{</span>
    <span class="keyword">if</span> (config.debug) console.log(response);
    response = $.parseJSON(response);
    $(<span class="string">'#step'</span>+currentStep.stepNumber+<span class="string">' #feedback #attribute'</span>).html(response.attribute);
    $(<span class="string">'#step'</span>+currentStep.stepNumber+<span class="string">' #feedback #attribute-2'</span>).html(response.attribute_2);
    $(<span class="string">'#step'</span>+currentStep.stepNumber+<span class="string">' #feedback #attribute-3'</span>).html(response.attribute_3);
    $(<span class="string">"#feedback"</span>).modal(<span class="string">"show"</span>);
    $(<span class="string">"#feedback-next"</span>).click(_goToNextStep);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>$(function () {
  $(&quot;#rating-handle&quot;).click(function () {
    if ($(this).parent().hasClass(&quot;popped&quot;)) {
      $(this).parent().animate({right:&#39;-310px&#39;}, {queue: false, duration: 500}).removeClass(&quot;popped&quot;);
  } else {
    $(this).parent().animate({right: &quot;-100px&quot; }, {queue: false, duration: 500}).addClass(&quot;popped&quot;);}
  });
});</p>
<p>$(&quot;#rating-stars&quot;).raty();
_getUserId();</p>
<p>$(&quot;#rating-btn&quot;).click(function(evt){
  var rating = $(&quot;#rating-stars&quot;).raty(&#39;score&#39;);
  if (rating == null){
    rating = null;
  }
  newRating = {
    rating : rating,
    lesson_or_step : &quot;step&quot;,
    lesson_or_step_id : currentStep.id,
    user_id : user_id,
    feedback : $(&#39;#rating-feedback&#39;).val()
  }</p>
<p>  if (config.debug) console.log(BfUser.name, user_id);</p>
<p>  $.ajax({
      type: &quot;POST&quot;,
      contentType: &quot;application/json&quot;,
      url: config.bfUrl+config.bfApiVersion+&#39;/ratings&#39;,
      data: JSON.stringify(newRating),
      dataType: &quot;json&quot;,
      success : function(response, textStatus, jqxhr){
        if (config.debug) console.log(jqxhr.status);
      }
    });
});</p>

            </div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>add public methods to the returned module and return it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  instructions.init = init;
  <span class="keyword">return</span> instructions;
}(instructions || {}));</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>initialize the module</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>instructions.init()</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
