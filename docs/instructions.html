<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>instructions.js</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  <div class='section'>
    <div class='docs'><h1>instructions.js</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kd">var</span> <span class="nx">instructions</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">instructions</span><span class="p">)</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>private properties</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">lesson</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="kd">var</span> <span class="nx">steps</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="kd">var</span> <span class="nx">previewLesson</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">){</span> <span class="c1">// Emailed links don&#39;t have an opener.</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">preview</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Preview&quot;</span><span class="p">)</span>
      <span class="nx">previewLesson</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">lesson</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">preview</span><span class="p">.</span><span class="nx">lessonName</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
      <span class="nx">lesson</span><span class="p">.</span><span class="nx">creator</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="nx">lesson</span><span class="p">.</span><span class="nx">service</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="nx">lesson</span><span class="p">.</span><span class="nx">creator</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">preview</span><span class="p">.</span><span class="nx">authorName</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
      <span class="nx">lesson</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">preview</span><span class="p">.</span><span class="nx">serviceName</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
      <span class="nx">lesson</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">preview</span><span class="p">.</span><span class="nx">serviceId</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
      <span class="nx">lesson</span><span class="p">.</span><span class="nx">steps</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">preview</span><span class="p">.</span><span class="nx">steps</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">lesson</span><span class="p">.</span><span class="nx">steps</span><span class="p">);</span>
      <span class="nx">lesson</span><span class="p">.</span><span class="nx">steps</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">parseJSON</span><span class="p">(</span><span class="nx">lesson</span><span class="p">.</span><span class="nx">steps</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>console.log(steps);</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">bodyPadding</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">lessonId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// Blank lesson</span>
  <span class="kd">var</span> <span class="nx">step</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="kd">var</span> <span class="nx">oauthToken</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">currentStep</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="kd">var</span> <span class="nx">rememberedAttribute</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">postData</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="kd">var</span> <span class="nx">originalCount</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">originalAttributeValues</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">challengeWindow</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">user_id</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">feedback</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>variables for meta lesson</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">userName</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">city</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">state</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>PUBLIC METHODS
initialize variables and load JSON</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">init</span><span class="p">(){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">previewLesson</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_main</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>Get lessonId from the url</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">lessonId</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Call the API and get that lesson</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">bfUrl</span><span class="o">+</span><span class="nx">config</span><span class="p">.</span><span class="nx">bfApiVersion</span><span class="o">+</span><span class="s1">&#39;/lessons/&#39;</span><span class="o">+</span><span class="nx">lessonId</span><span class="p">,</span> <span class="nx">_main</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>PRIVATE METHODS </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Main Function</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_main</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
    <span class="nx">_checkWindowSize</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">previewLesson</span><span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>Attach response to global lesson variable</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">lesson</span> <span class="o">=</span> <span class="nx">response</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>Set the name of the lesson</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#instructions-title&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">lesson</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Set author name</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">lesson</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#author-name&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">lesson</span><span class="p">.</span><span class="nx">creator</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>Make sure steps are in order of id</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">_orderSteps</span><span class="p">();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Convert python names to javascript names</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">_convertStepsAttributesNames</span><span class="p">();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>Set current step</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">currentStep</span> <span class="o">=</span> <span class="nx">steps</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>Initialize steps state</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">_updateStepsStates</span><span class="p">();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>Build progress bar</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">_makeProgressBar</span><span class="p">();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>Update progress Bar</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">_updateProgressBar</span><span class="p">();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>Show first step</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">_showStep</span><span class="p">();</span>
    <span class="nx">_checkStep</span><span class="p">();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>Adds button event handlers</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#back&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">_backClicked</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#next&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">_nextClicked</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#close-lesson&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span><span class="nb">window</span><span class="p">.</span><span class="nx">close</span><span class="p">();});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;li.progress-button&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">_progressClicked</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">_checkWindowSize</span><span class="p">(){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">&gt;</span> <span class="mi">340</span><span class="p">){</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">resizeTo</span><span class="p">(</span><span class="mi">340</span><span class="p">,</span><span class="nx">height</span><span class="p">);</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">width</span><span class="o">-</span><span class="mi">340</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">_orderSteps</span><span class="p">(){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ordering steps&#39;</span><span class="p">);</span>
    <span class="nx">steps</span> <span class="o">=</span> <span class="nx">lesson</span><span class="p">.</span><span class="nx">steps</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">step_number</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">step_number</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">step_number</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">step_number</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">})</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>Change steps attributes to have camelCase</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_convertStepsAttributesNames</span><span class="p">(){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Change attribute names to camelCase.&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">stepsWithJsNames</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">steps</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span>
      <span class="nx">step</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">id</span> <span class="o">:</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="p">,</span>
        <span class="nx">stepType</span> <span class="o">:</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">step_type</span><span class="p">,</span>
        <span class="nx">stepNumber</span> <span class="o">:</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">step_number</span><span class="p">,</span>
        <span class="nx">stepText</span> <span class="o">:</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">step_text</span><span class="p">,</span>
        <span class="nx">triggerEndpoint</span> <span class="o">:</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">trigger_endpoint</span><span class="p">,</span>
        <span class="nx">placeInCollection</span> <span class="o">:</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">place_in_collection</span><span class="p">,</span>
        <span class="nx">triggerCheck</span> <span class="o">:</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">trigger_check</span><span class="p">,</span>
        <span class="nx">triggerValue</span> <span class="o">:</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">trigger_value</span><span class="p">,</span>
        <span class="nx">thingToRemember</span> <span class="o">:</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">thing_to_remember</span><span class="p">,</span>
        <span class="nx">feedback</span> <span class="o">:</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">feedback</span><span class="p">,</span>
        <span class="nx">nextStepNumber</span> <span class="o">:</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">next_step_number</span><span class="p">,</span>
        <span class="nx">stepState</span> <span class="o">:</span> <span class="s2">&quot;unfinished&quot;</span>
      <span class="p">}</span>
      <span class="nx">stepsWithJsNames</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">step</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="nx">steps</span> <span class="o">=</span> <span class="nx">stepsWithJsNames</span><span class="p">;</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>Set the steps state</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_updateStepsStates</span><span class="p">(){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;updating steps states&#39;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">steps</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span> <span class="o">==</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">stepNumber</span><span class="p">){</span>
        <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">stepState</span> <span class="o">=</span> <span class="s2">&quot;active&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span> <span class="o">&gt;</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">stepNumber</span><span class="p">){</span>
        <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">stepState</span> <span class="o">=</span> <span class="s2">&quot;finished&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span> <span class="o">&lt;</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">stepNumber</span><span class="p">){</span>
        <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">stepState</span> <span class="o">=</span> <span class="s2">&quot;unfinished&quot;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>Make progress bar</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_makeProgressBar</span><span class="p">(){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;making progress bar&#39;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">steps</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.progress-dots&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;li id=&quot;step&#39;</span><span class="o">+</span><span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">stepNumber</span><span class="o">+</span><span class="s1">&#39;_progress&quot; class=&quot;progress-button&quot; data-target=&quot;&#39;</span><span class="o">+</span><span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">stepNumber</span><span class="o">+</span><span class="s1">&#39;&quot;&gt;&lt;/li&gt;&#39;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>Update the progress bar</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_updateProgressBar</span><span class="p">(){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;updating progress bar&#39;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">steps</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#step&#39;</span><span class="o">+</span><span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">stepNumber</span><span class="o">+</span><span class="s1">&#39;_progress&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;unfinished active finished&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">stepState</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">stepNumber</span> <span class="o">==</span> <span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#step&#39;</span><span class="o">+</span><span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">stepNumber</span><span class="o">+</span><span class="s1">&#39;_progress&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;h2&gt;&#39;</span><span class="o">+</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span><span class="o">+</span><span class="s1">&#39;&lt;/h2&gt;&#39;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#step&#39;</span><span class="o">+</span><span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">stepNumber</span><span class="o">+</span><span class="s1">&#39;_progress&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>Show the current step</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_showStep</span><span class="p">(){</span>
    <span class="nx">_stepTransition</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;showing step&#39;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;section&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;step&#39;</span><span class="o">+</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#step-text-content&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepText</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#feedback-content&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">feedback</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>Save progress of every step taken</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">previewLesson</span><span class="p">){</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Recording step completion.&quot;</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>Record most recent opened step</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">postData</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">currentStepId</span> <span class="o">:</span> <span class="nx">currentStep</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
          <span class="nx">currentLessonId</span> <span class="o">:</span> <span class="nx">lesson</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
          <span class="nx">auth</span> <span class="o">:</span> <span class="nx">BfUser</span><span class="p">.</span><span class="nx">bfAccessToken</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>console.log(postData);</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">BfUser</span><span class="p">.</span><span class="nx">record_step</span><span class="p">(</span><span class="nx">postData</span><span class="p">,</span> <span class="nx">_recordedStep</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">_stepTransition</span><span class="p">(){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Step Transition&#39;</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>next button is clicked</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_nextClicked</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span> <span class="o">&lt;</span> <span class="nx">steps</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
      <span class="nx">_goToNextStep</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>back button is clicked</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_backClicked</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">){</span>
      <span class="nx">currentStep</span> <span class="o">=</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span> <span class="o">-</span> <span class="mi">2</span><span class="p">];</span>
      <span class="nx">_updateStepsStates</span><span class="p">();</span>
      <span class="nx">_updateProgressBar</span><span class="p">();</span>
      <span class="nx">_showStep</span><span class="p">();</span>
      <span class="nx">_checkStep</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>progress circle li element is clicked</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_progressClicked</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Clicked Step: &quot;</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-target&#39;</span><span class="p">));</span>
    <span class="nx">currentStep</span> <span class="o">=</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-target&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
    <span class="nx">_updateStepsStates</span><span class="p">();</span>
    <span class="nx">_updateProgressBar</span><span class="p">();</span>
    <span class="nx">_showStep</span><span class="p">();</span>
    <span class="nx">_checkStep</span><span class="p">();</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>login clicked</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_loginClicked</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
    <span class="nx">service</span> <span class="o">=</span> <span class="nx">lesson</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Logging into &#39;</span><span class="o">+</span><span class="nx">service</span><span class="p">);</span>
    <span class="nx">OAuth</span><span class="p">.</span><span class="nx">initialize</span><span class="p">(</span><span class="s1">&#39;uZPlfdN3A_QxVTWR2s9-A8NEyZs&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">options</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">service</span> <span class="o">==</span> <span class="s1">&#39;facebook&#39;</span><span class="p">){</span>
      <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span><span class="nx">authorize</span><span class="o">:</span><span class="p">{</span><span class="nx">display</span><span class="o">:</span><span class="s2">&quot;popup&quot;</span><span class="p">}};</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">service</span> <span class="o">==</span> <span class="s1">&#39;foursquare&#39;</span><span class="p">){</span>
      <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span><span class="nx">authorize</span><span class="o">:</span><span class="p">{</span><span class="nx">display</span><span class="o">:</span><span class="s2">&quot;touch&quot;</span><span class="p">}};</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">service</span> <span class="o">==</span> <span class="s1">&#39;trello&#39;</span><span class="p">){</span>
      <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span><span class="nx">authorize</span><span class="o">:</span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;BizFriendly&quot;</span><span class="p">,</span><span class="nx">expiration</span><span class="o">:</span><span class="s2">&quot;never&quot;</span><span class="p">}};</span>
    <span class="p">}</span>
    <span class="nx">OAuth</span><span class="p">.</span><span class="nx">popup</span><span class="p">(</span><span class="nx">service</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>handle error with error</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)){</span>
        <span class="nx">oauthToken</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">access_token</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s2">&quot;oauth_token&quot;</span><span class="p">)){</span>
        <span class="nx">oauthToken</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">oauth_token</span><span class="p">;</span>
      <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>Add connection to server db</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span><span class="nx">service</span><span class="o">:</span> <span class="nx">service</span><span class="p">,</span> <span class="nx">service_access</span><span class="o">:</span> <span class="nx">oauthToken</span><span class="p">}</span>
      <span class="nx">BfUser</span><span class="p">.</span><span class="nx">create_connection</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">_createdConnection</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>Check first step</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">_checkStep</span><span class="p">();</span>  
    <span class="p">});</span> 
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">_goToNextStep</span><span class="p">(){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#feedback&quot;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">&quot;hide&quot;</span><span class="p">);</span>
    <span class="nx">currentStep</span> <span class="o">=</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span><span class="p">];</span>
    <span class="nx">_updateStepsStates</span><span class="p">();</span>
    <span class="nx">_updateProgressBar</span><span class="p">();</span>
    <span class="nx">_showStep</span><span class="p">();</span>
    <span class="nx">_checkStep</span><span class="p">();</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>Check steps</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_checkStep</span><span class="p">(){</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">currentStep</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>Create postData</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">postData</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">currentStep</span> <span class="o">:</span> <span class="nx">currentStep</span><span class="p">,</span>
      <span class="nx">rememberedAttribute</span> <span class="o">:</span> <span class="nx">rememberedAttribute</span><span class="p">,</span>
      <span class="nx">lessonName</span> <span class="o">:</span> <span class="nx">lesson</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
      <span class="nx">lessonId</span> <span class="o">:</span> <span class="nx">lesson</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
      <span class="nx">thirdPartyService</span> <span class="o">:</span> <span class="nx">service</span><span class="p">,</span>
      <span class="nx">originalCount</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">originalAttributeValues</span> <span class="o">:</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepType</span> <span class="o">==</span> <span class="s1">&#39;meta_intro&#39;</span><span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>Get the users name</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#userInputSubmit&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
        <span class="nx">userName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#userInput&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.responseDisplay&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">userName</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedback&#39;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.step_text&#39;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepType</span> <span class="o">==</span> <span class="s1">&#39;meta_location&#39;</span><span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>Get the users name</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s1">&#39;http://ip-api.com/json&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
        <span class="nx">city</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">city</span><span class="p">;</span>
        <span class="nx">state</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">regionName</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.cityName&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">city</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.stateName&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
        <span class="nx">rememberedAttribute</span> <span class="o">=</span> <span class="s1">&#39;find_loc=&#39;</span><span class="o">+</span><span class="nx">city</span><span class="o">+</span><span class="s1">&#39;,+&#39;</span><span class="o">+</span><span class="nx">state</span>
        <span class="nx">rememberedAttribute</span> <span class="o">=</span> <span class="nx">rememberedAttribute</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;+&#39;</span><span class="p">);</span>
      <span class="p">});</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <p>Check with them if location was correct</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#yes&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
        <span class="nx">_goToNextStep</span><span class="p">();</span>
      <span class="p">});</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>If no, then take in the new address</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#no&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedback&#39;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#feedbackYes&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.step_text&#39;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>Get new city, state and go to the next step.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#userInputSubmit&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
          <span class="nx">city</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#userInputCity&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
          <span class="nx">state</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#userInputState&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
          <span class="nx">rememberedAttribute</span> <span class="o">=</span> <span class="s1">&#39;find_loc=&#39;</span><span class="o">+</span><span class="nx">city</span><span class="o">+</span><span class="s1">&#39;,+&#39;</span><span class="o">+</span><span class="nx">state</span>
          <span class="nx">rememberedAttribute</span> <span class="o">=</span> <span class="nx">rememberedAttribute</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;+&#39;</span><span class="p">);</span>
          <span class="nx">_goToNextStep</span><span class="p">();</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepType</span> <span class="o">==</span> <span class="s1">&#39;meta_search&#39;</span><span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <p>Did they find their biz?</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.yes&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedback&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackYes&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackYes3&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackNo&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackNo2&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackNo3&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">()</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.step_text&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
      <span class="p">});</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      <p>If no, then search again</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.no&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedback&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackYes&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackYes3&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackNo&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackNo2&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackNo3&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">()</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.step_text&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
      <span class="p">});</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.no2&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedback&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackYes&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackYes3&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackNo&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackNo2&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackNo3&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">()</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.step_text&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
      <span class="p">});</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.yes3&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedback&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackYes&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackYes3&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackNo&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackNo2&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackNo3&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">()</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.step_text&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
      <span class="p">});</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.no3&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedback&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackYes&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackYes3&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackNo&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackNo2&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.feedbackNo3&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">()</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.step_text&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepType</span> <span class="o">==</span> <span class="s1">&#39;meta_signup&#39;</span><span class="p">){</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;meta_signup&#39;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#signup-name&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">userName</span><span class="p">);</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      <p>If step type is login</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepType</span> <span class="o">==</span> <span class="s1">&#39;login&#39;</span><span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      <p>First step should have a login button</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">oauthToken</span><span class="p">){</span>
          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#login&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">_loginClicked</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nx">_loggedIn</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      <p>If step type is open</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepType</span> <span class="o">==</span> <span class="s1">&#39;open&#39;</span><span class="p">){</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#open&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">_openClicked</span><span class="p">);</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      <p>If step type is check_for_new</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepType</span> <span class="o">==</span> <span class="s1">&#39;check_for_new&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">oauthToken</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;ORIGINAL COUNT: &quot;</span><span class="o">+</span><span class="nx">originalCount</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      <p>This step fires at least twice. First time it just gets the originalCount
Every following time it compares the number of objects to the originalCount</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span> <span class="nx">originalCount</span> <span class="o">!==</span> <span class="kc">false</span> <span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;originalCount: &quot;</span> <span class="o">+</span> <span class="nx">originalCount</span><span class="p">);</span>
        <span class="nx">postData</span><span class="p">[</span><span class="s2">&quot;originalCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">originalCount</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">BfUser</span><span class="p">.</span><span class="nx">check_for_new</span><span class="p">(</span><span class="nx">postData</span><span class="p">,</span> <span class="nx">_checkForNew</span><span class="p">);</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      <p>check_if_attribute_exists</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepType</span> <span class="o">==</span> <span class="s1">&#39;check_if_attribute_exists&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">oauthToken</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">currentStep</span><span class="p">);</span>
      <span class="nx">BfUser</span><span class="p">.</span><span class="nx">check_if_attribute_exists</span><span class="p">(</span><span class="nx">postData</span><span class="p">,</span> <span class="nx">_checkIfAttributeExists</span><span class="p">);</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      <p>check_attribute_for_value</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepType</span> <span class="o">==</span> <span class="s1">&#39;check_attribute_for_value&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">oauthToken</span><span class="p">){</span>
      <span class="nx">BfUser</span><span class="p">.</span><span class="nx">check_attribute_for_value</span><span class="p">(</span><span class="nx">postData</span><span class="p">,</span> <span class="nx">_checkAttributeForValue</span><span class="p">);</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      <p>Is step type get_attributes_from_input</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepType</span> <span class="o">==</span> <span class="s1">&#39;get_attributes_from_input&#39;</span><span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      <p>First get the id from the input</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#userInputSubmit&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">userInput</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#userInput&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      <p>If Foursquare, get venue id from input URL.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">service</span> <span class="o">==</span> <span class="s1">&#39;foursquare&#39;</span><span class="p">){</span>
          <span class="kd">var</span> <span class="nx">userInputPath</span> <span class="o">=</span> <span class="nx">userInput</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span> <span class="s1">&#39;/&#39;</span> <span class="p">);</span>
          <span class="nx">rememberedAttribute</span> <span class="o">=</span> <span class="nx">userInputPath</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">challengeWindow</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
        <span class="nx">_openChallengeWindow</span><span class="p">(</span><span class="nx">userInput</span><span class="p">);</span>

        <span class="nx">postData</span><span class="p">[</span><span class="s2">&quot;rememberedAttribute&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rememberedAttribute</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-54'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-54'>#</a>
      </div>
      <p>Then call get_attributes</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">BfUser</span><span class="p">.</span><span class="nx">get_attributes</span><span class="p">(</span><span class="nx">postData</span><span class="p">,</span> <span class="nx">_getAttributes</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-55'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-55'>#</a>
      </div>
      <p>check_attribute_for_update</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepType</span> <span class="o">==</span> <span class="s1">&#39;check_attribute_for_update&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">oauthToken</span><span class="p">){</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">originalAttributeValues</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-56'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-56'>#</a>
      </div>
      <p>This step fires at least twice. First time it just gets the originalAttributeValues
Every following time it compares the value of the attribute to the originalAttributeValues</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span> <span class="nx">originalAttributeValues</span> <span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;originalAttributeValues: &quot;</span> <span class="o">+</span> <span class="nx">originalAttributeValues</span><span class="p">);</span>
        <span class="nx">postData</span><span class="p">[</span><span class="s2">&quot;originalAttributeValues&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">originalAttributeValues</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">postData</span><span class="p">);</span>
      <span class="nx">BfUser</span><span class="p">.</span><span class="nx">check_attribute_for_update</span><span class="p">(</span><span class="nx">postData</span><span class="p">,</span> <span class="nx">_checkAttributeForUpdate</span><span class="p">);</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-57'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-57'>#</a>
      </div>
      <p>congrats</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepType</span> <span class="o">==</span> <span class="s1">&#39;congrats&#39;</span><span class="p">){</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#fb-share&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">,</span> <span class="s1">&#39;http://api.addthis.com/oexchange/0.8/forward/facebook/offer?pubId=ra-52043c6b31185dab&amp;url=http://bizfriend.ly/lesson.html?&#39;</span><span class="o">+</span><span class="nx">lessonId</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tw-share&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">,</span> <span class="s1">&#39;http://api.addthis.com/oexchange/0.8/forward/twitter/offer?pubId=ra-52043c6b31185dab&amp;url=http://bizfriend.ly/lesson.html?&#39;</span><span class="o">+</span><span class="nx">lessonId</span><span class="o">+</span><span class="s1">&#39;&amp;text=I just finished &#39;</span><span class="o">+</span><span class="nx">lesson</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="s1">&#39; with help from BizFriendly!&#39;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#g-share&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">,</span> <span class="s1">&#39;http://api.addthis.com/oexchange/0.8/forward/google_plusone_share/offer?pubId=ra-52043c6b31185dab&amp;url=http://bizfriend.ly/lesson.html?&#39;</span><span class="o">+</span><span class="nx">lessonId</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#li-share&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">,</span> <span class="s1">&#39;http://api.addthis.com/oexchange/0.8/forward/linkedin/offer?pubId=ra-52043c6b31185dab&amp;url=http://bizfriend.ly/lesson.html?&#39;</span><span class="o">+</span><span class="nx">lessonId</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#next&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#back&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#close-lesson&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#additional-resources&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="s2">&quot;service.html?&quot;</span><span class="o">+</span><span class="nx">serviceId</span><span class="p">;</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
      <span class="p">});</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#more-lessons&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="s2">&quot;learn.html&quot;</span><span class="p">;</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-58'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-58'>#</a>
      </div>
      <p>Show controls</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#next&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#back&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#close-lesson&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-59'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-59'>#</a>
      </div>
      <p>Add example popover clicker</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">example</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#example&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#example&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span><span class="s1">&#39;none&#39;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#popover&#39;</span><span class="p">).</span><span class="nx">popover</span><span class="p">({</span> <span class="nx">content</span><span class="o">:</span> <span class="nx">example</span><span class="p">,</span> <span class="nx">html</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">placement</span><span class="o">:</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="nx">trigger</span><span class="o">:</span> <span class="s1">&#39;hover&#39;</span> <span class="p">});</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-60'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-60'>#</a>
      </div>
      <p>They are loggedIn</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_loggedIn</span><span class="p">(){</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#feedback&quot;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#feedback-next&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">_goToNextStep</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-61'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-61'>#</a>
      </div>
      <p>Saved a connection in the db</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_createdConnection</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">_recordedStep</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-62'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-62'>#</a>
      </div>
      <p>Open up the main window to the web service we want to teach.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_openChallengeWindow</span><span class="p">(</span><span class="nx">url</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">screen</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">challengeFeatures</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">height</span><span class="o">:</span> <span class="nx">height</span><span class="p">,</span>
      <span class="nx">width</span><span class="o">:</span> <span class="nx">width</span> <span class="o">-</span> <span class="mi">340</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;challenge&#39;</span><span class="p">,</span>
      <span class="nx">center</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="nx">challengeWindow</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">popupWindow</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">challengeFeatures</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-63'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-63'>#</a>
      </div>
      <p>.open is clicked</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_openClicked</span><span class="p">(</span><span class="nx">evt</span><span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-64'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-64'>#</a>
      </div>
      <p>If url has replace_me in it, replace with rememberedAttribute</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">triggerEndpoint</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">rememberedAttribute</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">triggerEndpoint</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;replace_me&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
      <span class="nx">currentStep</span><span class="p">.</span><span class="nx">triggerEndpoint</span> <span class="o">=</span> <span class="nx">currentStep</span><span class="p">.</span><span class="nx">triggerEndpoint</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;replace_me&#39;</span><span class="p">,</span><span class="nx">rememberedAttribute</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">_openChallengeWindow</span><span class="p">(</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">triggerEndpoint</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-65'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-65'>#</a>
      </div>
      <p>Advance to next step</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#feedback&quot;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#feedback-next&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">_goToNextStep</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-66'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-66'>#</a>
      </div>
      <p>A new object is added at a url endpoint
Remember a certain attribute, object id for example.
Display another attribute</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_checkForNew</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
    <span class="nx">response</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">parseJSON</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">timeout</span><span class="p">)</span> <span class="nx">_checkStep</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">new_object_added</span> <span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">response</span><span class="p">.</span><span class="nx">original_count</span> <span class="o">!==</span> <span class="kc">false</span> <span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-67'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-67'>#</a>
      </div>
      <p>If no new thing added, yet there is an original count
then ask again with the count in the post data.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">originalCount</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">original_count</span><span class="p">;</span>
        <span class="nx">_checkStep</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">response</span><span class="p">.</span><span class="nx">new_object_added</span> <span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-68'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-68'>#</a>
      </div>
      <p>Remember the attribute!</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">rememberedAttribute</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">attribute_to_remember</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">attribute_to_display</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#step&#39;</span><span class="o">+</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span><span class="o">+</span><span class="s1">&#39; .responseDisplay&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span><span class="nx">response</span><span class="p">.</span><span class="nx">attribute_to_display</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#step&#39;</span><span class="o">+</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span><span class="o">+</span><span class="s1">&#39; .responseDisplay&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">attribute_to_display</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#feedback&quot;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#feedback-next&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">_goToNextStep</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-69'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-69'>#</a>
      </div>
      <p>Cancel out originalCount!!!</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">originalCount</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-70'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-70'>#</a>
      </div>
      <p>A certain attribute exists at the url endpoint
Display the returned attribute</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_checkIfAttributeExists</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
    <span class="nx">response</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">parseJSON</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">timeout</span><span class="p">)</span> <span class="nx">_checkStep</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">response</span><span class="p">.</span><span class="nx">attribute_exists</span> <span class="p">){</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#step&#39;</span><span class="o">+</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span><span class="o">+</span><span class="s1">&#39; .responseDisplay&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">attribute_to_display</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#feedback&quot;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#feedback-next&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">_goToNextStep</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-71'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-71'>#</a>
      </div>
      <p>A certain attribute equals a determined value
Display the returned attribute</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_checkAttributeForValue</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
    <span class="nx">response</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">parseJSON</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">timeout</span><span class="p">)</span> <span class="nx">_checkStep</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">attribute_value_matches</span><span class="p">)</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-72'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-72'>#</a>
      </div>
      <p>If the repsonse is an url of an image, attach it to the source.
ToDo: Make sure this is an actual image, in the future we might want urls</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">attribute_to_display</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#step&#39;</span><span class="o">+</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span><span class="o">+</span><span class="s1">&#39; .responseDisplay&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span><span class="nx">response</span><span class="p">.</span><span class="nx">attribute_to_display</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#step&#39;</span><span class="o">+</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span><span class="o">+</span><span class="s1">&#39; .responseDisplay&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">attribute_to_display</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#feedback&quot;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#feedback-next&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">_goToNextStep</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-73'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-73'>#</a>
      </div>
      <p>An attribute of the object is updated
Display that attribute</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_checkAttributeForUpdate</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
    <span class="nx">response</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">parseJSON</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">timeout</span><span class="p">)</span> <span class="nx">_checkStep</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">attribute_value_updated</span> <span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">response</span><span class="p">.</span><span class="nx">original_attribute_values</span> <span class="o">!=</span> <span class="kc">false</span> <span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-74'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-74'>#</a>
      </div>
      <p>If the attribute hasn't been updated, yet we have the original value
then ask again with the original value in the request.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">originalAttributeValues</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">original_attribute_values</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Checking again with original_value&#39;</span><span class="p">);</span>
        <span class="nx">_checkStep</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">response</span><span class="p">.</span><span class="nx">attribute_value_updated</span> <span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-75'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-75'>#</a>
      </div>
      <p>Remember the attribute!
rememberedAttribute = response.attribute_to_remember;</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#step&#39;</span><span class="o">+</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span><span class="o">+</span><span class="s1">&#39; .responseDisplay&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">attribute_to_display</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#feedback&quot;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#feedback-next&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">_goToNextStep</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-76'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-76'>#</a>
      </div>
      <p>Cancel out original attributes!!!</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="nx">originalAttributeValues</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-77'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-77'>#</a>
      </div>
      <p>Display the returned attributes</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">_getAttributes</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
    <span class="nx">response</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">parseJSON</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#step&#39;</span><span class="o">+</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span><span class="o">+</span><span class="s1">&#39; #feedback #attribute&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">attribute</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#step&#39;</span><span class="o">+</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span><span class="o">+</span><span class="s1">&#39; #feedback #attribute-2&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">attribute_2</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#step&#39;</span><span class="o">+</span><span class="nx">currentStep</span><span class="p">.</span><span class="nx">stepNumber</span><span class="o">+</span><span class="s1">&#39; #feedback #attribute-3&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">attribute_3</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#feedback&quot;</span><span class="p">).</span><span class="nx">modal</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#feedback-next&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="nx">_goToNextStep</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-78'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-78'>#</a>
      </div>
      <p>$(function () {
  $("#rating-handle").click(function () {
    if ($(this).parent().hasClass("popped")) {
      $(this).parent().animate({right:'-310px'}, {queue: false, duration: 500}).removeClass("popped");
  } else {
    $(this).parent().animate({right: "-100px" }, {queue: false, duration: 500}).addClass("popped");}
  });
});</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-79'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-79'>#</a>
      </div>
      <p>$("#rating-stars").raty();
_getUserId();</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-80'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-80'>#</a>
      </div>
      <p>$("#rating-btn").click(function(evt){
  var rating = $("#rating-stars").raty('score');
  if (rating == null){
    rating = null;
  }
  newRating = {
    rating : rating,
    lesson_or_step : "step",
    lesson_or_step_id : currentStep.id,
    user_id : user_id,
    feedback : $('#rating-feedback').val()
  }</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-81'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-81'>#</a>
      </div>
      <p>if (config.debug) console.log(BfUser.name, user_id);</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-82'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-82'>#</a>
      </div>
      <p>$.ajax({
      type: "POST",
      contentType: "application/json",
      url: config.bfUrl+config.bfApiVersion+'/ratings',
      data: JSON.stringify(newRating),
      dataType: "json",
      success : function(response, textStatus, jqxhr){
        if (config.debug) console.log(jqxhr.status);
      }
    });
});</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-83'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-83'>#</a>
      </div>
      <p>add public methods to the returned module and return it</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="nx">instructions</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="nx">init</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">instructions</span><span class="p">;</span>
<span class="p">}(</span><span class="nx">instructions</span> <span class="o">||</span> <span class="p">{}));</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-84'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-84'>#</a>
      </div>
      <p>initialize the module</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nx">instructions</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
